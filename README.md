## ETL_DATA with pyspark

## About this Project
  - Nexon Open Api에서 제공하는 3만등 이내 유저의 랭킹데이터를 수집합니다.
  - SparkSQL을 이용하여 데이터를 정제하며 3가지 데이터 모델을 생성합니다.
  - 생성된 데이터모델을 ElasticSearch 와 MySQL에 저장합니다.
  - ElasticSearch에 저장된 데이터는 Kibana를 이용해 데이터를 시각화합니다.

## About DataModel


  - DataModel 1

|key_value                   |Tallahart|Carcion|Arteria|Dowonkyung|sum |rank|date      |class            |
|:-------------------------|:------------|:------------|:------------|:------------|:------------|:------------|:-------------------|:------------|
|2024-09-02-아델             |49       |487    |1131   |866       |2533|1   |2024-09-02|아델             |
|2024-09-02-비숍             |85       |526    |1019   |737       |2367|2   |2024-09-02|비숍             |
|2024-09-02-나이트로드       |70       |465    |776    |519       |1830|3   |2024-09-02|나이트로드       |
|2024-09-02-듀얼블레이더     |60       |398    |748    |530       |1736|4   |2024-09-02|듀얼블레이더     |
|2024-09-02-섀도어           |27       |249    |579    |506       |1361|5   |2024-09-02|섀도어           |
|2024-09-02-아크메이지(불,독)|52       |343    |539    |396       |1330|6   |2024-09-02|아크메이지(불,독)|
|2024-09-02-윈드브레이커     |19       |211    |483    |396       |1109|7   |2024-09-02|윈드브레이커     |
|2024-09-02-소울마스터       |19       |160    |440    |457       |1076|8   |2024-09-02|소울마스터       |
|2024-09-02-아크메이지(썬,콜)|26       |245    |445    |329       |1045|9   |2024-09-02|아크메이지(썬,콜)|
|2024-09-02-패스파인더       |17       |214    |416    |330       |977 |10  |2024-09-02|패스파인더       |


  - DataModel 2

|group_key           |class       |status |count|increase_exp_sum|increase_exp_max|increase_exp_avg     |date      |hunting_rank|
|:------------|:------------|:------------|:------------|:------------|:------------|:------------|:-------------------|:------------
|일리움-Arteria      |일리움      |Arteria|15   |35051338688431  |4662276558251   |2.336755912562067E12 |2024-09-02|1           |
|시티즌-Arteria      |시티즌      |Arteria|1    |2220509848584   |2220509848584   |2.220509848584E12    |2024-09-02|2           |
|카데나-Arteria      |카데나      |Arteria|38   |75016675957891  |6322632369515   |1.9741230515234473E12|2024-09-02|3           |
|스트라이커-Arteria  |스트라이커  |Arteria|24   |46427139094171  |6853797479459   |1.9344641289237917E12|2024-09-02|4           |
|나이트워커-Arteria  |나이트워커  |Arteria|138  |262558314339310 |9939833368686   |1.9025964807196377E12|2024-09-02|5           |
|제논-Arteria        |제논        |Arteria|43   |78951131779061  |5566919005901   |1.836072832071186E12 |2024-09-02|6           |
|칼리-Arteria        |칼리        |Arteria|34   |62357636840249  |6317331455154   |1.8340481423602646E12|2024-09-02|7           |
|비숍-Arteria        |비숍        |Arteria|496  |878085064428174 |10017387181911  |1.7703327911858347E12|2024-09-02|8           |
|메르세데스-Arteria  |메르세데스  |Arteria|118  |204284195875114 |7629734190673   |1.731221998941644E12 |2024-09-02|9           |
|윈드브레이커-Arteria|윈드브레이커|Arteria|168  |277470413536695 |6408155581758   |1.6516096043850894E12|2024-09-02|10          |


  - DataModel 3

|character_name|class            |character_level|need_exp_level_up|increase_exp  |date      |need_day_level_up|
|:-------------|:----------------|:-----|:-------------|:-----------------|:------------------|:----|
|버터          |나이트로드       |297            |933695967467934  |12679718366176|2024-09-02|74.0             |
|헨쇼          |아델             |296            |688893299521462  |10028457921555|2024-09-02|69.0             |
|케인WWE챔프   |배틀메이지       |295            |270889230081703  |13239637749399|2024-09-02|20.0             |
|Kiss예진      |아델             |295            |845423412803980  |12002616732723|2024-09-02|70.0             |
|벨벨          |스트라이커       |295            |432495774197049  |5297257302582 |2024-09-02|82.0             |
|Lacheln       |은월             |295            |745269394944949  |7129899947300 |2024-09-02|105.0            |
|곤주          |아크메이지(불,독)|295            |709640106376562  |6664535660782 |2024-09-02|106.0            |
|광선          |제논             |295            |700812566603492  |1692137253400 |2024-09-02|414.0            |
|검성OGC       |히어로           |294            |15626215180000   |5267987971268 |2024-09-02|3.0              |
|중뒹          |비숍             |294            |45758734650437   |11560817830645|2024-09-02|4.0              |



  - DataModel 4

|class            |date      |status_change|count|
|:-------------|:----------------|:---------------------|:-------|
|배틀메이지       |2024-09-04|stay here    |269  |
|아델             |2024-09-04|stay here    |2512 |
|시티즌           |2024-09-04|stay here    |2    |
|블래스터         |2024-09-04|stay here    |163  |
|나이트로드       |2024-09-04|go Carcion!  |1    |
|아크메이지(불,독)|2024-09-04|stay here    |1324 |
|듀얼블레이더     |2024-09-04|go Carcion!  |1    |
|소울마스터       |2024-09-04|stay here    |1069 |
|팔라딘           |2024-09-04|go Arteria!  |2    |
|엔젤릭버스터     |2024-09-04|go Arteria!  |1    |



## Directory Structure

```
| MySQL
  |- Dockerfile for build MySQL
| data
  |- Nexon Open Api data goes here
| jobs
  |- pyspark files go here
| resources
  |- .jars for spark third-party app(elastic Search and MySQL)
| docker-compose.yml
```

## How to run pyspark project

run containers:

``` bash
$ docker-compose up -d
```

spark-submit:

``` bash
$ docker exec -it etl_data-spark-master-1 spark-submit --jars <resource/jarsfile.jar> --master spark://spark-master:7077 jobs/main.py
```