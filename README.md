# ETL_DATA with pyspark :rocket:


## í”„ë¡œì íŠ¸ ê°œìš” :star2:
Nexon Open APIë¥¼ í†µí•´ ì œê³µëœ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ì—˜ë¦¬ì‹œì›€ ì„œë²„ì˜ ê°œì¸ ë­í‚¹ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. 

Pythonìœ¼ë¡œ ì‘ì„±ëœ SparkJobì„ í†µí•´ ì •ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  5ê°€ì§€ ë°ì´í„° ëª¨ë¸ì„ ìƒì„±í•©ë‹ˆë‹¤. 

ìƒì„±ëœ ë°ì´í„° ëª¨ë¸ì€ ElasticSearchì™€ MySQLì— ì €ì¥ë˜ë©° Kibanaë¥¼ í†µí•´ ì‹œê°í™”í•©ë‹ˆë‹¤.


## ê¸°ìˆ  ìŠ¤íƒ ğŸ› ï¸
  - Nexon Open API : ë°ì´í„° ì†ŒìŠ¤
  - PySpark : ë°ì´í„° ì²˜ë¦¬ ë° ì •ì œ
  - ElasticSearch : ë°ì´í„° ì €ì¥ ë° ê²€ìƒ‰
  - MySQL : ë°ì´í„° ì €ì¥
  - Kibana : ë°ì´í„° ì‹œê°í™”


## ë°ì´í„° ëª¨ë¸ ì„¤ëª… :chart_with_upwards_trend:


  ### ë°ì´í„° ëª¨ë¸ 1 : ì§ì—…ë³„ ì§€ì—­ ë¶„í¬ :globe_with_meridians:
ì´ ëª¨ë¸ì€ ì§ì—…ë³„ "ë„ì›ê²½" ì´ìƒì˜ ìœ ì € ë¶„í¬ì™€ ë¹„ìœ¨ì„ ì‹œê°í™” í•˜ëŠ” ê²ƒì— ì´ìš©ë©ë‹ˆë‹¤.


|key_value                   |Tallahart|Carcion|Arteria|Dowonkyung|sum |rank|date      |class            |
|:-------------------------|:------------|:------------|:------------|:------------|:------------|:------------|:-------------------|:------------|
|2024-09-09-ì•„ë¸             |53       |500    |1138   |832       |2523|1   |2024-09-09|ì•„ë¸             |
|2024-09-09-ë¹„ìˆ             |91       |534    |1026   |725       |2376|2   |2024-09-09|ë¹„ìˆ             |
|2024-09-09-ë‚˜ì´íŠ¸ë¡œë“œ       |79       |471    |772    |513       |1835|3   |2024-09-09|ë‚˜ì´íŠ¸ë¡œë“œ       |
|2024-09-09-ë“€ì–¼ë¸”ë ˆì´ë”     |63       |403    |750    |505       |1721|4   |2024-09-09|ë“€ì–¼ë¸”ë ˆì´ë”     |
|2024-09-09-ì„€ë„ì–´           |31       |253    |575    |494       |1353|5   |2024-09-09|ì„€ë„ì–´           |
|2024-09-09-ì•„í¬ë©”ì´ì§€(ë¶ˆ,ë…)|55       |349    |541    |385       |1330|6   |2024-09-09|ì•„í¬ë©”ì´ì§€(ë¶ˆ,ë…)|
|2024-09-09-ìœˆë“œë¸Œë ˆì´ì»¤     |20       |221    |483    |384       |1108|7   |2024-09-09|ìœˆë“œë¸Œë ˆì´ì»¤     |
|2024-09-09-ì†Œìš¸ë§ˆìŠ¤í„°       |20       |164    |443    |438       |1065|8   |2024-09-09|ì†Œìš¸ë§ˆìŠ¤í„°       |
|2024-09-09-ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|33       |244    |453    |324       |1054|9   |2024-09-09|ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|
|2024-09-09-íŒ¨ìŠ¤íŒŒì¸ë”       |19       |220    |412    |326       |977 |10  |2024-09-09|íŒ¨ìŠ¤íŒŒì¸ë”       |

***

  ### ë°ì´í„° ëª¨ë¸ 2 : ì§ì—…êµ°ë³„ ê²½í—˜ì¹˜ íšë“ëŸ‰ :muscle:
ì´ ëª¨ë¸ì€ ê°€ì¥ ë§ì€ ê²½í—˜ì¹˜ë¥¼ íšë“í•œ ì§ì—…êµ°ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤.

ì§‘ê³„ ì „ë‚ ì˜ ë ˆë²¨ê³¼ ë³´ìœ  ê²½í—˜ì¹˜ë¥¼ ê³ ë ¤í•˜ì—¬ ë„ì¶œëœ ê²°ê³¼ë¡œ, íšë“ ê²½í—˜ì¹˜ê°€ 500,000,000,000 ì´ìƒì¸ ìœ ì €ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì§‘ê³„ë©ë‹ˆë‹¤. 

íŒ¨ì¹˜ì— ë”°ë¥¸ ì§ì—…êµ°ë³„ ê²½í—˜ì¹˜ íšë“ëŸ‰ì˜ ì–‘ìƒì„ ì˜ˆì¸¡í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

|class     |status |count|increase_exp_sum|increase_exp_max|increase_exp_avg     |date      |key_value                    |hunting_rank|
|:----------------------------|:--------------------|:------------|:------------|:------------|:------------|:------------|:-------------------|:------------|
|ë©”ì¹´ë‹‰    |Arteria|14   |28304715181086  |6786306030892   |2.0217653700775715E12|2024-09-09|ë©”ì¹´ë‹‰-Arteria-2024-09-09    |1           |
|ë‚˜ì´íŠ¸ì›Œì»¤|Arteria|105  |194999826743771 |8053036690376   |1.8571412070835334E12|2024-09-09|ë‚˜ì´íŠ¸ì›Œì»¤-Arteria-2024-09-09|2           |
|ì¹¼ë¦¬      |Arteria|27   |50123579006474  |5266952296343   |1.8564288520916296E12|2024-09-09|ì¹¼ë¦¬-Arteria-2024-09-09      |3           |
|ì¼ë¦¬ì›€    |Arteria|9    |15373240640881  |3636051229345   |1.7081378489867778E12|2024-09-09|ì¼ë¦¬ì›€-Arteria-2024-09-09    |4           |
|ë°°í‹€ë©”ì´ì§€|Arteria|34   |56476299083697  |6370581425857   |1.6610676201087354E12|2024-09-09|ë°°í‹€ë©”ì´ì§€-Arteria-2024-09-09|5           |
|íŒ¬í…€      |Arteria|99   |163888924390808 |10054312357337  |1.6554436807152324E12|2024-09-09|íŒ¬í…€-Arteria-2024-09-09      |6           |
|ìº¡í‹´      |Arteria|29   |47763107212937  |6253501836118   |1.6470036969978276E12|2024-09-09|ìº¡í‹´-Arteria-2024-09-09      |7           |
|ì œë…¼      |Arteria|34   |55833831926342  |6332382614020   |1.642171527245353E12 |2024-09-09|ì œë…¼-Arteria-2024-09-09      |8           |
|ë¹„ìˆ      |Arteria|379  |620512229878666 |9492018178659   |1.637235435036058E12 |2024-09-09|ë¹„ìˆ-Arteria-2024-09-09      |9           |
|ë³´ìš°ë§ˆìŠ¤í„°|Arteria|53   |86698559347474  |5655290702736   |1.6358218744806416E12|2024-09-09|ë³´ìš°ë§ˆìŠ¤í„°-Arteria-2024-09-09|10          |


***

  ### ë°ì´í„° ëª¨ë¸ 3 : ìœ ì €ë³„ ê²½í—˜ì¹˜ ì§‘ê³„ :hourglass_flowing_sand:
ì´ ëª¨ë¸ì€ ìœ ì €ë³„ë¡œ ì§‘ê³„ì¼ ê¸°ì¤€ ë ˆë²¨ì—…ì— í•„ìš”í•œ ê²½í—˜ì¹˜ ì–‘ì„ ê³„ì‚°í•©ë‹ˆë‹¤. 

ì „ë‚  ëŒ€ë¹„ ì¦ê°€í•œ ê²½í—˜ì¹˜ ì–‘ì„ í†µí•´ ë‹¤ìŒ ë ˆë²¨ì—…ê¹Œì§€ ê±¸ë¦¬ëŠ” ê¸°ê°„ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²½í—˜ì¹˜ ì¦ê°€ëŸ‰ì€ ì „ë‚ ê³¼ ì§‘ê³„ì¼ ëª¨ë‘ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì— ëŒ€í•´ ì§‘ê³„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.
 
ìœ ì €ì˜ ì´íƒˆë¥ ì„ ê³„ì‚°í•˜ëŠ” ë°ë„ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  **ì£¼ìš” ì†ì„±:**
- **`need_exp_level_up`**: ì§‘ê³„ì¼ ê¸°ì¤€ ë ˆë²¨ê³¼ ë³´ìœ  ê²½í—˜ì¹˜ì˜ ì°¨ì´ë¥¼ ì´ìš©í•´ ë„ì¶œ
  > (ìŒìˆ˜ë¡œ í‘œí˜„ëœ ìˆ˜ì¹˜ì˜ ìœ ì €ë“¤ì€ ê²½í—˜ì¹˜ ê°ëŸ‰ íŒ¨ì¹˜ ì´í›„ ì ‘ì†ì„ í•˜ì§€ ì•Šì€ ìœ ì €ì…ë‹ˆë‹¤. ì ‘ì†ì‹œ ë ˆë²¨ì—…ì„ í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.)
- **`increase_exp`**: ì§‘ê³„ì¼ìì™€ ì „ë‚ ì˜ ë°ì´í„°ë¥¼ ë¹„êµí•˜ì—¬ ì¦ê°€í•œ ê²½í—˜ì¹˜ëŸ‰ì„ ë„ì¶œ
- **`need_day_level_up`**: í•„ìš” ê²½í—˜ì¹˜ëŸ‰ê³¼ ì¦ê°€í•œ ê²½í—˜ì¹˜ëŸ‰ì„ ì´ìš©í•´ ë‹¤ìŒ ë ˆë²¨ì—… ì¼ìë¥¼ ì˜ˆì¸¡


|character_name|class            |character_level|need_exp_level_up|increase_exp|date      |need_day_level_up|key_value              |
|:-------------|:----------------|:-----|:-------------|:-----------------|:------------------|:--------------------|:--------------------|
|ìŠ¹íŒ”          |íŒ”ë¼ë”˜           |280            |-4226031907569   |0           |2024-09-09|we need you T^T  |ìŠ¹íŒ”-2024-09-09        |
|í¬ë¼ë¯¸ìˆ˜      |ì•„ë¸             |280            |-3458066432187   |0           |2024-09-09|we need you T^T  |í¬ë¼ë¯¸ìˆ˜-2024-09-09    |
|ìŠ¤í˜ì˜¤ë””      |ë¹„ìˆ             |278            |-2153235707178   |0           |2024-09-09|we need you T^T  |ìŠ¤í˜ì˜¤ë””-2024-09-09    |
|ë ˆí¬íƒ€        |ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|276            |-1968251774425   |0           |2024-09-09|we need you T^T  |ë ˆí¬íƒ€-2024-09-09      |
|ì•¼ìˆ˜ë¯¼ì„      |ì•„ë¸             |276            |-1955485424557   |0           |2024-09-09|we need you T^T  |ì•¼ìˆ˜ë¯¼ì„-2024-09-09    |
|ì€ì„œë´        |ì•„ë¸             |276            |-1679954619695   |0           |2024-09-09|we need you T^T  |ì€ì„œë´-2024-09-09      |
|OëŒ€êµ¬ìŠ¤íƒ€ì¼O  |ì•„ë¸             |279            |-1478275223603   |0           |2024-09-09|we need you T^T  |OëŒ€êµ¬ìŠ¤íƒ€ì¼O-2024-09-09|
|íƒ€ë„ì—°        |ë‚˜ì´íŠ¸ë¡œë“œ       |277            |-1338082828865   |0           |2024-09-09|we need you T^T  |íƒ€ë„ì—°-2024-09-09      |
|êµ¬ë©ë‚œë ˆê¹…ìŠ¤  |í‚¤ë„¤ì‹œìŠ¤         |276            |-920907375495    |0           |2024-09-09|we need you T^T  |êµ¬ë©ë‚œë ˆê¹…ìŠ¤-2024-09-09|
|ê¹€ë‹¤ì˜¤ë‹ˆ      |ë“€ì–¼ë¸”ë ˆì´ë”     |279            |-420853100096    |0           |2024-09-09|we need you T^T  |ê¹€ë‹¤ì˜¤ë‹ˆ-2024-09-09    |


|character_name|class            |character_level|need_exp_level_up|increase_exp  |date      |need_day_level_up|key_value          |
|:-------------|:----------------|:-----|:-------------|:-----------------|:------------------|:--------------------|:--------------------|
|ë²„í„°          |ë‚˜ì´íŠ¸ë¡œë“œ       |297            |845602925603379  |17873103802689|2024-09-09|47.0             |ë²„í„°-2024-09-09    |
|ì˜ì˜          |ì•„ë€             |289            |35672002855018   |15657861826732|2024-09-09|2.0              |ì˜ì˜-2024-09-09    |
|ë²¨ë‹˜          |ì¹´ì¸             |290            |294284107422718  |14487395763317|2024-09-09|20.0             |ë²¨ë‹˜-2024-09-09    |
|ë²•í–‰          |ì•„í¬ë©”ì´ì§€(ë¶ˆ,ë…)|294            |317266302378141  |13654591854001|2024-09-09|23.0             |ë²•í–‰-2024-09-09    |
|í™˜íƒ€êº¼        |ë¹„ìˆ             |289            |44286884508017   |12354962593089|2024-09-09|4.0              |í™˜íƒ€êº¼-2024-09-09  |
|ì• ë¿”          |ì™€ì¼ë“œí—Œí„°       |288            |132264311880226  |12269909625568|2024-09-09|11.0             |ì• ë¿”-2024-09-09    |
|ì‚¬ë¶€          |ë°”ì´í¼           |290            |8859485232819    |12198018091393|2024-09-09|Congratulation!  |ì‚¬ë¶€-2024-09-09    |
|ë„ë¹„          |ì™€ì¼ë“œí—Œí„°       |293            |197277110199205  |12154337680630|2024-09-09|16.0             |ë„ë¹„-2024-09-09    |
|ë•Œë¦´êº¼ì˜      |ì•„ë¸             |287            |52719167002490   |12104500969917|2024-09-09|4.0              |ë•Œë¦´êº¼ì˜-2024-09-09|
|ì›…ì†o         |ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|288            |111678899679811  |12084700991687|2024-09-09|9.0              |ì›…ì†o-2024-09-09   |


***

 ### ë°ì´í„° ëª¨ë¸ 4 : ììœ ì „ì§ ì¡°íšŒ í…Œì´ë¸” :mag_right:
ëª¨í—˜ê°€ ì§ì—…êµ°ì˜ ììœ ì „ì§ ì—¬ë¶€ë¥¼ ì¡°íšŒí• ë•Œì˜ ì„±ëŠ¥ì„ ìœ„í•œ í…Œì´ë¸” ì…ë‹ˆë‹¤.

- **for SQL**

|character_name|character_level|class            |date      |key_value          |
|:-------------|:----------------|:---------------------|:-------|:-----------|
|ë²„í„°          |297            |ë‚˜ì´íŠ¸ë¡œë“œ       |2024-09-09|ë²„í„°-2024-09-09    |
|ì˜ì˜          |289            |ì•„ë€             |2024-09-09|ì˜ì˜-2024-09-09    |
|ë²¨ë‹˜          |290            |ì¹´ì¸             |2024-09-09|ë²¨ë‹˜-2024-09-09    |
|ë²•í–‰          |294            |ì•„í¬ë©”ì´ì§€(ë¶ˆ,ë…)|2024-09-09|ë²•í–‰-2024-09-09    |
|í™˜íƒ€êº¼        |289            |ë¹„ìˆ             |2024-09-09|í™˜íƒ€êº¼-2024-09-09  |
|ì• ë¿”          |288            |ì™€ì¼ë“œí—Œí„°       |2024-09-09|ì• ë¿”-2024-09-09    |
|ì‚¬ë¶€          |290            |ë°”ì´í¼           |2024-09-09|ì‚¬ë¶€-2024-09-09    |
|ë„ë¹„          |293            |ì™€ì¼ë“œí—Œí„°       |2024-09-09|ë„ë¹„-2024-09-09    |
|ë•Œë¦´êº¼ì˜      |287            |ì•„ë¸             |2024-09-09|ë•Œë¦´êº¼ì˜-2024-09-09|
|ì›…ì†o         |288            |ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|2024-09-09|ì›…ì†o-2024-09-09   |

***

 ### ë°ì´í„° ëª¨ë¸ 5 : ë ˆë²¨ ë„ë‹¬ ìœ ì € ìˆ˜ :dart:
ì´ ëª¨ë¸ì€ 280, 285, 290ê³¼ ê°™ì€ ìƒìœ„ ì§€ì—­ ì§„ì…ì„ ìœ„í•œ ë ˆë²¨ì— ë„ë‹¬í•œ ìœ ì €ì˜ ìˆ˜ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.

2024.08.22 ê¸°ì¤€ 3ë§Œë“± ì´ë‚´ì˜ ìœ ì €ë“¤ì€ ëª¨ë‘ 275ë ˆë²¨ì„ ì´ˆê³¼í•©ë‹ˆë‹¤. 


|class            |date      |status_change|count|
|:-------------|:----------------|:---------------------|:-------|
|íŒ¬í…€             |2024-09-09|stay here    |734  |
|ë°ëª¬ìŠ¬ë ˆì´ì–´     |2024-09-09|stay here    |274  |
|ì„€ë„ì–´           |2024-09-09|go Arteria!  |2    |
|ë³´ìš°ë§ˆìŠ¤í„°       |2024-09-09|stay here    |425  |
|í”Œë ˆì„ìœ„ìë“œ     |2024-09-09|stay here    |242  |
|ì•„í¬ë©”ì´ì§€(ì¬,ì½œ)|2024-09-09|go Tallahart!|2    |
|ì€ì›”             |2024-09-09|stay here    |525  |
|í‚¤ë„¤ì‹œìŠ¤         |2024-09-09|go Carcion!  |1    |
|ë¹„ìˆ             |2024-09-09|go Carcion!  |2    |
|ì‹ ê¶             |2024-09-09|stay here    |203  |
|ë‚˜ì´íŠ¸ë¡œë“œ       |2024-09-09|go Arteria!  |3    |
|ì„€ë„ì–´           |2024-09-09|go Tallahart!|1    |
|ì¹¼ë¦¬             |2024-09-09|go Arteria!  |1    |
|íˆì–´ë¡œ           |2024-09-09|stay here    |956  |
|ì•„í¬ë©”ì´ì§€(ë¶ˆ,ë…)|2024-09-09|go Carcion!  |2    |
|ìœˆë“œë¸Œë ˆì´ì»¤     |2024-09-09|go Arteria!  |3    |
|ë°°í‹€ë©”ì´ì§€       |2024-09-09|stay here    |265  |
|ë£¨ë¯¸ë„ˆìŠ¤         |2024-09-09|stay here    |331  |
|ë°ëª¬ì–´ë²¤ì ¸       |2024-09-09|stay here    |411  |
|í‚¤ë„¤ì‹œìŠ¤         |2024-09-09|stay here    |214  |
|ìº¡í‹´             |2024-09-09|stay here    |196  |
|ë‚˜ì´íŠ¸ì›Œì»¤       |2024-09-09|go Arteria!  |2    |
|ë©”ë¥´ì„¸ë°ìŠ¤       |2024-09-09|stay here    |558  |
|íŒ”ë¼ë”˜           |2024-09-09|stay here    |589  |
|ë…¸ë¸”ë ˆìŠ¤         |2024-09-09|stay here    |1    |
|ì¹¼ë¦¬             |2024-09-09|stay here    |153  |
|ë¹„ìˆ             |2024-09-09|go Arteria!  |3    |
|ë“€ì–¼ë¸”ë ˆì´ë”     |2024-09-09|go Arteria!  |2    |
|ë³´ìš°ë§ˆìŠ¤í„°       |2024-09-09|go Carcion!  |1    |
|ì†Œìš¸ë§ˆìŠ¤í„°       |2024-09-09|go Carcion!  |1    |



## ë””ë ‰í† ë¦¬ êµ¬ì¡° :card_index_dividers:

```
| MySQL
  |- Dockerfile for build MySQL
| data
  |- Nexon Open Api data goes here
| jobs
  |- pyspark files go here
| resources
  |- .jars for spark third-party app(elastic Search and MySQL)
| docker-compose.yml
```

## ì‹¤í–‰ë°©ë²• :dart:

1. **ì»¨í…Œì´ë„ˆ ì‹¤í–‰**:

``` bash
$ docker-compose up -d
```

2. **spark-submit**:

``` bash
$ docker exec -it etl_data-spark-master-1 spark-submit --jars <resource/jarsfile.jar> --master spark://spark-master:7077 jobs/main.py
```
